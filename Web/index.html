<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="watch.js" type="text/javascript"></script>
    <script src="util.js" type="text/javascript"></script>
    <script src="/_comet.io/comet.io.client.js"></script>
    <title>easy chat test</title>
</head>
<body>

    <div id="content">
    </div>

    <p>
        <input type="text" name="word" id="word" value="" />
    </p>

    <script>

        //define root class
        var chatList =  function(){
            var self = this;
            //message list
            this.lists = [];
            //watch on change
            doUIWatch(this,function(prop, action, newval, oldval){
                if(action == "push" )
                {
                    //if lists add a item,add a div message in ui
                    $('#content').append('<div>' + newval[0].message + '</div>');
                }
            })
        };

        //new a root item
        var chatRoot = new chatList();
        //bind item to a sync session
        var session1=new opSession(chatRoot,"10000", "http://" + window.location.host ,true);
        //if user input on and enter add a new message
        $('#word').bind('keydown', function (e) {
            var key = e.which;
            if (key == 13) {
                chatRoot.lists.push({ message : $('#word').val()});
            }
        });

    </script>

</body>
</html>